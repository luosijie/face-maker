{"version":3,"sources":["webpack:///./src/components/playboard.mpx?115f","webpack:///./src/components/playboard.mpx","webpack:///./node_modules/@babel/runtime-corejs3/core-js-stable/instance/find-index.js","webpack:///./node_modules/core-js-pure/stable/instance/find-index.js","webpack:///./node_modules/core-js-pure/es/instance/find-index.js","webpack:///./node_modules/core-js-pure/es/array/virtual/find-index.js","webpack:///./node_modules/core-js-pure/modules/es.array.find-index.js","webpack:///./node_modules/@babel/runtime-corejs3/core-js-stable/instance/find.js","webpack:///./node_modules/core-js-pure/stable/instance/find.js","webpack:///./node_modules/core-js-pure/es/instance/find.js","webpack:///./node_modules/core-js-pure/es/array/virtual/find.js","webpack:///./node_modules/core-js-pure/modules/es.array.find.js","webpack:///./src/store/index.js","webpack:///./src/components/playboard.mpx?0e87","webpack:///./src/components/playboard.mpx?f257","webpack:///./src/components/playboard.mpx?0b8c"],"names":["store","createStore","state","ctx","elements","mode","mutations","setCtx","data","setElements","setMode"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACyI;;AAEzI;AACA,mBAAO,CAAC,GAAgb;;AAExb;AACA,mBAAO,CAAC,GAA4P;;AAEpQ;AACA,mBAAO,CAAC,GAAsb;;;;;;;;;;;;;;;;;;;;;;;;;;ACe9b;AACA;AACA,4E,CACA;;AACA;AACA,cADA;AACA;AACA,gBAFA;AAEA;AACA,kBAHA;AAGA;AACA,cAJA,CAIA;;AAJA;AAOA;AACA;AACA,oBADA;AAEA;AACA,UADA;AAEA;AAFA,KAFA;AAMA,kBANA,CAMA;;AANA,GADA;AASA;AACA;AACA;AACA,KAHA;;AAIA;AACA;AACA,KANA;;AAOA;AACA;AACA;;AATA,GATA;AAoBA;AACA;AAAA;AAAA;;AACA;AACA;;AACA,MAAM,+GAAN;AACA;;AACA;AACA;;AACA;AACA;;AACA,8BACA,sCADA,EAEA,uCAFA,EAJA,CAQA;;;AACA;;AACA;;AACA;AACA;;AACA;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;AACA;AACA,OA1BA;;AA2BA,sBA9BA,CA+BA;AACA;AACA;AACA;AACA;;AApCA,GApBA;AA0DA;AACA,mBACA;AACA;AACA;AACA;AACA;AACA,KAPA;;AAQA;AAAA;;AACA;AACA;AACA;AACA;;AACA;AAAA;AAAA;;AACA;AACA;AACA;AACA;AACA;AACA,KAnBA;;AAoBA;AACA;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;AAAA;AAAA;;AACA;;AACA;AACA;AACA;AACA;;AACA;AACA;AACA,oCACA,wEACA,+CADA,EACA,CADA,CADA;AAIA,kCACA,2FADA;AAGA;AACA;;AACA;AAAA;AAAA;;AACA;;AACA;;AACA;AACA;AACA,KAnDA;;AAoDA;AACA;AACA;AACA,KAvDA;;AAwDA;AAAA;;AACA;AACA;AACA,YACA,MADA,CACA,SADA,EAEA,MAFA,CAEA;AAAA;AAAA;AAAA,OAFA,EAGA,IAHA,CAGA;AACA;AACA;AACA;AAEA;AACA;AACA,0CAPA,CASA;;AACA;AACA,uBADA;AAEA;AACA;AACA;AACA;;AACA;AACA,iDADA,CAEA;;AACA;AACA;AACA;AACA,6BADA;AAEA,+BAFA;AAGA,uBAHA;AAIA,sBAJA;AAKA,wBALA;AAMA,yBANA;AAOA,wBAPA;AAQA;AARA;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA,eANA,MAMA;AACA;;AACA;AACA;AACA;AACA;AACA;;AACA,kCA5BA,CA6BA;;AACA;AACA,4BADA;AAEA,6BAFA;AAGA,yBAHA;AAIA;AAJA;AAMA;AACA,aArCA;AAsCA;AA5CA;AA8CA,OA3DA;AA4DA,KAvHA;;AAwHA;AACA;AACA,oDAFA,CAGA;;AACA;AACA;AACA,mCANA,CAOA;;AACA;AACA;AACA;AACA;AACA;AACA,OAbA,CAcA;;;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AA7IA,GA1DA;;AAyMA;AACA;AACA;;AA3MA,G;;;;;;;ACrCA,iBAAiB,mBAAO,CAAC,GAAyC,E;;;;;;;ACAlE,aAAa,mBAAO,CAAC,GAA8B;;AAEnD;;;;;;;;ACFA,gBAAgB,mBAAO,CAAC,GAA6B;;AAErD;;AAEA;AACA;AACA;AACA;;;;;;;;ACPA,mBAAO,CAAC,GAAsC;AAC9C,mBAAmB,mBAAO,CAAC,GAAkC;;AAE7D;;;;;;;;;ACHa;AACb,QAAQ,mBAAO,CAAC,EAAqB;AACrC,iBAAiB,mBAAO,CAAC,EAA8B;AACvD,uBAAuB,mBAAO,CAAC,EAAiC;AAChE,8BAA8B,mBAAO,CAAC,GAA0C;;AAEhF;AACA;;AAEA;;AAEA;AACA,wDAAwD,qBAAqB,EAAE;;AAE/E;AACA;AACA,GAAG,uEAAuE;AAC1E;AACA;AACA;AACA,CAAC;;AAED;AACA;;;;;;;;ACvBA,iBAAiB,mBAAO,CAAC,GAAmC,E;;;;;;;ACA5D,aAAa,mBAAO,CAAC,GAAwB;;AAE7C;;;;;;;;ACFA,WAAW,mBAAO,CAAC,GAAuB;;AAE1C;;AAEA;AACA;AACA;AACA;;;;;;;;ACPA,mBAAO,CAAC,GAAgC;AACxC,mBAAmB,mBAAO,CAAC,GAAkC;;AAE7D;;;;;;;;;ACHa;AACb,QAAQ,mBAAO,CAAC,EAAqB;AACrC,YAAY,mBAAO,CAAC,EAA8B;AAClD,uBAAuB,mBAAO,CAAC,EAAiC;AAChE,8BAA8B,mBAAO,CAAC,GAA0C;;AAEhF;AACA;;AAEA;;AAEA;AACA,4CAA4C,qBAAqB,EAAE;;AAEnE;AACA;AACA,GAAG,uEAAuE;AAC1E;AACA;AACA;AACA,CAAC;;AAED;AACA;;;;;;;;;ACvBA;AAAA;AAAA;AAEA,IAAMA,KAAK,GAAGC,+DAAW,CAAC;AACxBC,OAAK,EAAE;AACLC,OAAG,EAAE,IADA;AAELC,YAAQ,EAAE,EAFL;AAGLC,QAAI,EAAE;AAHD,GADiB;AAMxBC,WAAS,EAAE;AACTC,UAAM,CAAEL,KAAF,EAASM,IAAT,EAAe;AACnBN,WAAK,CAACC,GAAN,GAAYK,IAAZ;AACD,KAHQ;;AAITC,eAAW,CAAEP,KAAF,EAASM,IAAT,EAAe;AACxBN,WAAK,CAACE,QAAN,GAAiBI,IAAjB;AACD,KANQ;;AAOTE,WAAO,CAAER,KAAF,EAASM,IAAT,EAAe;AACpBN,WAAK,CAACG,IAAN,GAAaG,IAAb;AACD;;AATQ;AANa,CAAD,CAAzB;AAmBeR,oEAAf,E;;;;;;;ACrBA,uB;;;;;;;ACAA,uB;;;;;;;ACAA,uB","file":"components/playboard5295a42f/playboard.js","sourcesContent":["global.currentModuleId\n/* script */\nexport * from \"!!babel-loader!../../node_modules/@mpxjs/webpack-plugin/lib/selector?type=script&index=0!./playboard.mpx?packageName=main\"\n\n/* styles */\nrequire(\"!!../../node_modules/@mpxjs/webpack-plugin/lib/extractor?type=styles&index=0!../../node_modules/@mpxjs/webpack-plugin/lib/wxss/loader?sourceMap&root=&importLoaders=1&extract=true!../../node_modules/@mpxjs/webpack-plugin/lib/style-compiler/index?{\\\"moduleId\\\":\\\"maaae044e\\\",\\\"scoped\\\":false,\\\"sourceMap\\\":true}!stylus-loader!../../node_modules/@mpxjs/webpack-plugin/lib/selector?type=styles&index=0!./playboard.mpx?packageName=main\")\n\n/* json */\nrequire(\"!!../../node_modules/@mpxjs/webpack-plugin/lib/extractor?type=json&index=0!../../node_modules/@mpxjs/webpack-plugin/lib/json-compiler/index?root=!../../node_modules/@mpxjs/webpack-plugin/lib/selector?type=json&index=0!./playboard.mpx?packageName=main\")\n\n/* template */\nrequire(\"!!../../node_modules/@mpxjs/webpack-plugin/lib/extractor?type=template&index=0!../../node_modules/@mpxjs/webpack-plugin/lib/wxml/wxml-loader?root=!../../node_modules/@mpxjs/webpack-plugin/lib/template-compiler/index?{\\\"usingComponents\\\":[],\\\"hasScoped\\\":false,\\\"isNative\\\":false,\\\"moduleId\\\":\\\"maaae044e\\\",\\\"projectRoot\\\":\\\"\\\"}!../../node_modules/@mpxjs/webpack-plugin/lib/selector?type=template&index=0!./playboard.mpx?packageName=main\")\n\n","<template>\n  <view class=\"playboard\">\n    <canvas\n      type=\"2d\"\n      id=\"canvas\"\n      class=\"canvas\"\n      bindtouchstart=\"touchstart\"\n      bindtouchmove=\"touchmove\"\n      bindtouchend=\"touchend\"\n    />\n    <image\n      class=\"icon-add\"\n      src=\"../assets/images/icon-add-image.png\"\n      alt=\"添加图片\"\n      bindtouchstart=\"chooseImage\"\n    />\n    <image\n      class=\"icon-add\"\n      src=\"../assets/images/icon-add-image.png\"\n      alt=\"添加图片\"\n      bindtouchstart=\"chooseImage\"\n    />\n  </view>\n</template>\n\n<script>\nimport { createComponent } from '@mpxjs/core'\nimport store from '../store'\nconst imageUrl = 'https://res.wx.qq.com/wxdoc/dist/assets/img/0.4cb08bb4.jpg'\n// import example from '../assets/images/example.jpeg'\nconst ACTION_TYEP = {\n  MOVE: 'MOVE', // 移动\n  SCALE: 'SCALE', // 缩放\n  ROTATE: 'ROTATE', // 旋转\n  NULL: 'NULL' // 空闲\n}\n\ncreateComponent({\n  data: {\n    startTouches: [],\n    startSelected: {\n      x: 0,\n      y: 0\n    },\n    actionType: '' // move, scale, rotate\n  },\n  computed: {\n    ctx() {\n      return store.state.ctx\n    },\n    elements() {\n      return store.state.elements\n    },\n    dpr() {\n      return wx.getSystemInfoSync().pixelRatio\n    }\n  },\n  watch: {\n    elements() {\n      // console.log('canvas elements change')\n      this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height)\n      this.elements.forEach(ele => {\n        console.log('eles', ele)\n        if (ele.type === 'image') {\n          this.ctx.save()\n          const left = ele.left - this.ctx.canvas.width / this.dpr / 2\n          const top = ele.top - this.ctx.canvas.height / this.dpr / 2\n          this.ctx.translate(\n            this.ctx.canvas.width / this.dpr / 2,\n            this.ctx.canvas.height / this.dpr / 2\n          )\n          // this.ctx.rotate(1)\n          this.ctx.scale(ele.scale, ele.scale)\n          this.ctx.drawImage(ele.data, left, top, ele.width, ele.height)\n          this.ctx.restore()\n        }\n        if (ele.type === 'text') {\n          this.ctx.save()\n          console.log('this.ctx', this.ctx)\n          this.ctx.setTextBaseline('top')\n          this.ctx.setLineDash([10, 5], 5)\n          this.ctx.strokeStyle = 'red'\n          this.ctx.strokeRect(ele.left - 5, ele.top + 10, 150 + 10, -30 - 10)\n          this.ctx.font = '30px sans-serif'\n          this.ctx.fillText(ele.data, ele.left, ele.top)\n          this.ctx.restore()\n        }\n      })\n      this.drawGrid()\n      // console.log('touch-move', this.ctx.canvas.width / 2, this.ctx.canvas.height / 2)\n      // this.ctx.rotate(1)\n      // this.ctx.scale(1.1, 1.1)\n      // this.ctx.rotate(Math.PI / 2)\n    }\n  },\n  methods: {\n    chooseImage() {\n      // wx.chooseImage({\n      //   success (res) {\n      //     console.log('res', res)\n      //   }\n      // })\n    },\n    touchstart(e) {\n      if (e.touches.length === 1) this.actionType = ACTION_TYEP.MOVE\n      if (e.touches.length === 2) this.actionType = ACTION_TYEP.SCALE\n      console.log('touch-start', e)\n      this.startTouches = e.touches\n      const image = store.state.elements.find(e => e.type === 'image')\n      if (image) {\n        this.startSelected.x = image.left\n        this.startSelected.y = image.top\n        this.startSelected.scale = image.scale\n      }\n    },\n    touchmove(e) {\n      console.log('this.actionType', this.actionType, e.touches)\n      if (this.actionType === ACTION_TYEP.MOVE) {\n        if (e.touches.length > 1) return\n        const x = e.touches[0].x\n        const y = e.touches[0].y\n        const dx = this.startTouches[0].x - x\n        const dy = this.startTouches[0].y - y\n        const elements = store.state.elements\n        const index = elements.findIndex(e => e.type === 'image')\n        const image = elements.splice(index, 1)[0]\n        image.left = this.startSelected.x - dx\n        image.top = this.startSelected.y - dy\n        elements.unshift(image)\n      }\n      if (this.actionType === ACTION_TYEP.SCALE) {\n        if (e.touches.length !== 2) return\n        const startLength = Math.sqrt(\n          (this.startTouches[0].x - this.startTouches[1].x) ** 2 +\n            (this.startTouches[0].y - this.startTouches[1].y) ** 2\n        )\n        const endLength = Math.sqrt(\n          (e.touches[0].x - e.touches[1].x) ** 2 + (e.touches[0].y - e.touches[1].y) ** 2\n        )\n        const scale = endLength / startLength\n        const elements = store.state.elements\n        const index = elements.findIndex(e => e.type === 'image')\n        const image = elements.splice(index, 1)[0]\n        image.scale = this.startSelected.scale * scale\n        elements.push(image)\n      }\n    },\n    touchend(e) {\n      this.actionType = ACTION_TYEP.NULL\n      console.log('touch-end', e)\n    },\n    initCanvas() {\n      const query = this.createSelectorQuery()\n      const elements = store.state.elements\n      query\n        .select('#canvas')\n        .fields({ node: true, size: true })\n        .exec(res => {\n          const canvas = res[0].node\n          const ctx = canvas.getContext('2d')\n          store.commit('setCtx', ctx)\n\n          canvas.width = res[0].width * this.dpr\n          canvas.height = res[0].height * this.dpr\n          ctx.scale(this.dpr, this.dpr)\n\n          // \b初始化一张背景图\n          wx.getImageInfo({\n            src: imageUrl,\n            success: res => {\n              console.log('get-image-url', res)\n              const imageData = canvas.createImage()\n              imageData.src = imageUrl\n              imageData.onload = e => {\n                console.log('imageData-loaded', e)\n                // ctx.drawImage(res.path, 0, 0, 100, 100)\n                const cWidth = canvas.width / this.dpr\n                const cHeight = canvas.height / this.dpr\n                const data = {\n                  type: 'image',\n                  data: imageData,\n                  left: 0,\n                  top: 0,\n                  width: 0,\n                  height: 0,\n                  scale: 1,\n                  rotate: 0\n                }\n                if (res.height > res.width) {\n                  const rate = res.height / cHeight\n                  data.width = res.width / rate\n                  data.height = cHeight\n                  data.left = (cWidth - data.width) / 2\n                  data.top = 0\n                } else {\n                  const rate = res.width / cWidth\n                  data.height = res.height / rate\n                  data.width = cWidth\n                  data.left = 0\n                  data.top = (cHeight - data.height) / 2\n                }\n                elements.push(data)\n                // store.commit('setElements', elements)// 初始化一段文字\n                const text = {\n                  type: 'text',\n                  data: '请输入文字',\n                  left: 100,\n                  top: 100\n                }\n                elements.push(text)\n              }\n            }\n          })\n        })\n    },\n    drawGrid() {\n      const lineNums = 3\n      const cWidth = this.ctx.canvas.width / this.dpr\n      // const cHeight = this.ctx.canvas.height\n      const lineGap = cWidth / lineNums\n      this.ctx.strokeStyle = '#ccc'\n      this.ctx.setLineDash([5, 5])\n      // \b\b绘制x轴\n      for (let i = 0; i <= lineNums; i++) {\n        this.ctx.beginPath()\n        this.ctx.moveTo(0, lineGap * i)\n        this.ctx.lineTo(cWidth, lineGap * i)\n        this.ctx.stroke()\n      }\n      // 绘制y轴\n      for (let i = 0; i <= lineNums; i++) {\n        this.ctx.beginPath()\n        this.ctx.moveTo(lineGap * i, 0)\n        this.ctx.lineTo(lineGap * i, cWidth)\n        this.ctx.stroke()\n      }\n    }\n  },\n  ready() {\n    this.initCanvas()\n  }\n})\n</script>\n\n<style lang=\"stylus\">\n.playboard\n  position relative\n  width 100vw\n  height 100vw\n  background #f8f8f8\n.canvas\n  width 100vw\n  height 100vw\n.icon-add\n  position absolute\n  width 160rpx\n  height 160rpx\n  left 50%\n  top 50%\n  margin-top -80rpx\n  margin-left -80rpx\n</style>\n\n<script type=\"application/json\">\n  {\n    \"component\": true\n  }\n</script>\n","module.exports = require(\"core-js-pure/stable/instance/find-index\");","var parent = require('../../es/instance/find-index');\n\nmodule.exports = parent;\n","var findIndex = require('../array/virtual/find-index');\n\nvar ArrayPrototype = Array.prototype;\n\nmodule.exports = function (it) {\n  var own = it.findIndex;\n  return it === ArrayPrototype || (it instanceof Array && own === ArrayPrototype.findIndex) ? findIndex : own;\n};\n","require('../../../modules/es.array.find-index');\nvar entryVirtual = require('../../../internals/entry-virtual');\n\nmodule.exports = entryVirtual('Array').findIndex;\n","'use strict';\nvar $ = require('../internals/export');\nvar $findIndex = require('../internals/array-iteration').findIndex;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND_INDEX = 'findIndex';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND_INDEX);\n\n// Shouldn't skip holes\nif (FIND_INDEX in []) Array(1)[FIND_INDEX](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.findIndex` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.findindex\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  findIndex: function findIndex(callbackfn /* , that = undefined */) {\n    return $findIndex(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND_INDEX);\n","module.exports = require(\"core-js-pure/stable/instance/find\");","var parent = require('../../es/instance/find');\n\nmodule.exports = parent;\n","var find = require('../array/virtual/find');\n\nvar ArrayPrototype = Array.prototype;\n\nmodule.exports = function (it) {\n  var own = it.find;\n  return it === ArrayPrototype || (it instanceof Array && own === ArrayPrototype.find) ? find : own;\n};\n","require('../../../modules/es.array.find');\nvar entryVirtual = require('../../../internals/entry-virtual');\n\nmodule.exports = entryVirtual('Array').find;\n","'use strict';\nvar $ = require('../internals/export');\nvar $find = require('../internals/array-iteration').find;\nvar addToUnscopables = require('../internals/add-to-unscopables');\nvar arrayMethodUsesToLength = require('../internals/array-method-uses-to-length');\n\nvar FIND = 'find';\nvar SKIPS_HOLES = true;\n\nvar USES_TO_LENGTH = arrayMethodUsesToLength(FIND);\n\n// Shouldn't skip holes\nif (FIND in []) Array(1)[FIND](function () { SKIPS_HOLES = false; });\n\n// `Array.prototype.find` method\n// https://tc39.github.io/ecma262/#sec-array.prototype.find\n$({ target: 'Array', proto: true, forced: SKIPS_HOLES || !USES_TO_LENGTH }, {\n  find: function find(callbackfn /* , that = undefined */) {\n    return $find(this, callbackfn, arguments.length > 1 ? arguments[1] : undefined);\n  }\n});\n\n// https://tc39.github.io/ecma262/#sec-array.prototype-@@unscopables\naddToUnscopables(FIND);\n","import { createStore } from '@mpxjs/core'\n\nconst store = createStore({\n  state: {\n    ctx: null,\n    elements: [],\n    mode: ''\n  },\n  mutations: {\n    setCtx (state, data) {\n      state.ctx = data\n    },\n    setElements (state, data) {\n      state.elements = data\n    },\n    setMode (state, data) {\n      state.mode = data\n    }\n  }\n})\n\nexport default store\n","// removed by extractor","// removed by extractor","// removed by extractor"],"sourceRoot":""}